<!DOCTYPE html>
<html>
  <head>
    <title>天气信息展示</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <style>
      * {
        padding: 0;
        margin: 0;
      }
    </style>
  </head>
  <body>
    <input type="file" id="imageInput" />
    <canvas id="canvas" style="display: none"></canvas>

    <div id="map" style="height: 500px"></div>

    <script>
      document
        .getElementById("imageInput")
        .addEventListener("change", handleImage, false);

      function handleImage(e) {
        const reader = new FileReader();
        reader.onload = function (event) {
          const img = new Image();
          img.onload = function () {
            const canvas = document.getElementById("canvas");
            const ctx = canvas.getContext("2d");
            canvas.width = img.width;
            canvas.height = img.height;
            ctx.drawImage(img, 0, 0);
            processImage(canvas);
          };
          img.src = event.target.result;
        };
        reader.readAsDataURL(e.target.files[0]);
      }

      function processImage(canvas) {
        const ctx = canvas.getContext("2d");
        const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
        const data = imageData.data;

        for (let i = 0; i < data.length; i += 4) {
          const r = data[i];
          const g = data[i + 1];
          const b = data[i + 2];
          const a = data[i + 3];

          // 在这里处理每个像素的颜色数据
          const weatherInfo = parsePixelColor(r, g, b, a);
          // 根据需要存储或使用weatherInfo
        }
      }

      function parsePixelColor(r, g, b, a) {
        // 根据颜色值解析天气信息的逻辑
        // 示例：假设某种颜色代表某种天气
        if (r === 255 && g === 0 && b === 0) {
          return "Sunny";
        } else if (r === 0 && g === 255 && b === 0) {
          return "Rainy";
        }
        // 其他颜色的解析逻辑
        return "Unknown";
      }

      const map = L.map("map").setView([51.505, -0.09], 13);
      L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
        attribution:
          '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
      }).addTo(map);

      function addWeatherMarker(lat, lng, weatherInfo) {
        const marker = L.marker([lat, lng]).addTo(map);
        marker.bindPopup(`<b>Weather:</b> ${weatherInfo}`).openPopup();
      }

      // 示例：将某个天气信息标记到地图上
      addWeatherMarker(51.5, -0.09, "Sunny");
    </script>
  </body>
</html>
